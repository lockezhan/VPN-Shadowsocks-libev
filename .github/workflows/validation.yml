name: Shell Script Validation

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  shellcheck:
    name: ShellCheck Analysis
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Run ShellCheck
      uses: ludeeus/action-shellcheck@master
      with:
        scandir: '.'
        severity: warning
        
  syntax-check:
    name: Bash Syntax Check
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Check bash syntax
      run: |
        bash -n install.sh
        bash -n uninstall.sh
        for script in scripts/*.sh; do
          echo "Checking $script"
          bash -n "$script"
        done
        
  json-validation:
    name: JSON Validation
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Validate JSON files
      run: |
        python3 -m json.tool config/config.json.example > /dev/null
        echo "JSON validation passed"
        
  test-installation:
    name: Test Installation Script
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Test script execution
      run: |
        # Test that scripts can be sourced without errors
        bash -c "source scripts/common.sh && echo 'common.sh OK'"
        bash -c "source scripts/system_check.sh && echo 'system_check.sh OK'"
        
    - name: Check file permissions
      run: |
        test -x install.sh && echo "install.sh is executable"
        test -x uninstall.sh && echo "uninstall.sh is executable"
        for script in scripts/*.sh; do
          test -x "$script" && echo "$script is executable"
        done
